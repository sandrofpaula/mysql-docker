### Tabela: Instruções para Conectar Contêineres Docker e Configurar Rede Compartilhada

| Passo                                                         | Português (Brasil)                                                                                          | English (USA)                                                                                     |
|---------------------------------------------------------------|--------------------------------------------------------------------------------------------------------------|---------------------------------------------------------------------------------------------------|
| **1. Criar uma Rede Docker Compartilhada**                    | Primeiro, crie uma rede Docker onde todos os contêineres que precisam se comunicar serão conectados. Vamos criar uma rede chamada `minha_rede_compartilhada`: <br><br>```bash<br>docker network create minha_rede_compartilhada<br>``` <br>Esse comando cria uma rede Docker chamada `minha_rede_compartilhada`. Qualquer contêiner conectado a essa rede poderá se comunicar com os outros contêineres na mesma rede. | First, create a Docker network where all containers that need to communicate will be connected. Let's create a network named `my_shared_network`: <br><br>```bash<br>docker network create my_shared_network<br>``` <br>This command creates a Docker network named `my_shared_network`. Any container connected to this network will be able to communicate with other containers on the same network. |
| **2. Conectar os Contêineres à Rede Compartilhada**           | Agora, conecte cada um dos contêineres existentes (`mysql_dev`, `sistema_alpha`, e `sistema_beta`) à rede `minha_rede_compartilhada`: <br><br>- Conecte o contêiner `mysql_dev` à rede: <br>```bash<br>docker network connect minha_rede_compartilhada mysql_dev<br>``` <br>- Conecte o contêiner `sistema_alpha` à rede: <br>```bash<br>docker network connect minha_rede_compartilhada sistema_alpha<br>``` <br>- Conecte o contêiner `sistema_beta` à rede: <br>```bash<br>docker network connect minha_rede_compartilhada sistema_beta<br>``` <br>Com isso, todos os contêineres agora fazem parte da mesma rede `minha_rede_compartilhada` e podem se comunicar entre si. | Now, connect each of the existing containers (`mysql_dev`, `system_alpha`, and `system_beta`) to the `my_shared_network`: <br><br>- Connect the `mysql_dev` container to the network: <br>```bash<br>docker network connect my_shared_network mysql_dev<br>``` <br>- Connect the `system_alpha` container to the network: <br>```bash<br>docker network connect my_shared_network system_alpha<br>``` <br>- Connect the `system_beta` container to the network: <br>```bash<br>docker network connect my_shared_network system_beta<br>``` <br>Now, all containers are part of the same `my_shared_network` and can communicate with each other. |
| **3. Verificar Contêineres Conectados à Rede**                | Depois de conectar os contêineres à rede, você pode querer verificar quais contêineres estão realmente conectados à `minha_rede_compartilhada`. Para isso, use o seguinte comando: <br><br>```bash<br>docker network inspect minha_rede_compartilhada<br>``` <br>Este comando retorna informações detalhadas sobre a rede, incluindo uma seção chamada `Containers`, que lista todos os contêineres conectados a ela. | After connecting the containers to the network, you may want to verify which containers are actually connected to `my_shared_network`. To do so, use the following command: <br><br>```bash<br>docker network inspect my_shared_network<br>``` <br>This command returns detailed information about the network, including a section called `Containers`, which lists all containers connected to it. |
| **4. Configurar o Yii2 para Conectar ao MySQL**               | Agora que os contêineres estão na mesma rede, precisamos ajustar a configuração da conexão ao banco de dados no Yii2, tanto no `sistema_alpha` quanto no `sistema_beta`, para que eles usem o contêiner `mysql_dev` como servidor MySQL. <br><br>No arquivo de configuração do Yii2 (`config/db.php`), atualize o `dsn` para usar `mysql_dev` como o host: <br><br>```php<br>return [<br> 'class' => 'yii\db\Connection',<br> 'dsn' => 'mysql:host=mysql_dev;dbname=biblioteca',<br> 'username' => 'root',<br> 'password' => '',<br> 'charset' => 'utf8',<br> 'tablePrefix' => 'tb_',<br>];<br>``` | Now that the containers are on the same network, we need to adjust the database connection configuration in Yii2, both in `system_alpha` and `system_beta`, so they use the `mysql_dev` container as the MySQL server. <br><br>In the Yii2 configuration file (`config/db.php`), update the `dsn` to use `mysql_dev` as the host: <br><br>```php<br>return [<br> 'class' => 'yii\db\Connection',<br> 'dsn' => 'mysql:host=mysql_dev;dbname=library',<br> 'username' => 'root',<br> 'password' => '',<br> 'charset' => 'utf8',<br> 'tablePrefix' => 'tb_',<br>];<br>``` |
| **5. Listar Todas as Redes Docker Existentes**                | Para listar todas as redes Docker existentes no seu ambiente, utilize o comando: <br><br>```bash<br>docker network ls<br>``` <br>Este comando exibirá uma lista de todas as redes Docker, incluindo as redes padrão e quaisquer redes personalizadas que você tenha criado. | To list all existing Docker networks in your environment, use the command: <br><br>```bash<br>docker network ls<br>``` <br>This command will display a list of all Docker networks, including the default networks and any custom networks you have created. |
| **6. Apagar uma Rede Docker**                                 | Para apagar uma rede Docker, você pode usar o comando `docker network rm`. Esse comando permite que você remova uma rede específica. <br><br>```bash<br>docker network rm <nome_da_rede><br>``` <br>Substitua `<nome_da_rede>` pelo nome da rede que você deseja apagar. | To remove a Docker network, you can use the `docker network rm` command. This command allows you to remove a specific network. <br><br>```bash<br>docker network rm <network_name><br>``` <br>Replace `<network_name>` with the name of the network you want to delete. |
| **7. Ajustar o Mapeamento de Portas de um Contêiner Docker**  | Você pode ajustar o mapeamento de portas de um contêiner Docker existente sem precisar apagar e recriar o contêiner, mas isso envolve alguns passos manuais, pois o Docker não permite diretamente remapear as portas de um contêiner já criado. <br><br>Aqui está o processo que você pode seguir: <br><br>1. **Pare o contêiner existente:** <br>```bash<br>docker stop mysql_dev<br>``` <br>2. **Renomeie ou remova o contêiner existente (opcional):** <br>Para evitar conflitos, você pode renomear o contêiner existente ou removê-lo (apenas o contêiner, não os dados): <br>**Renomear:** <br>```bash<br>docker rename mysql_dev mysql_dev_old<br>``` <br>**Remover o contêiner (mantendo os dados no volume):** <br>```bash<br>docker rm mysql_dev<br>``` <br>3. **Inicie um novo contêiner com a nova configuração de porta:** <br>Use o comando abaixo para iniciar um novo contêiner usando a nova configuração de portas: <br>```bash<br>docker run -d --name mysql_dev -p 37:3306 \ <br>-e MYSQL_ROOT_PASSWORD='suaSenhaSegura' \ <br>-v mysql_data:/var/lib/mysql \ <br>mysql:8.0<br>``` <br>4. **Verifique se o contêiner está em execução:** <br>Confirme que o novo contêiner está em execução e que a porta foi mapeada corretamente: <br>```bash<br>docker ps<br>``` <br>Isso deve mostrar o contêiner `mysql_dev` com a porta 37 mapeada para 3306. | You can adjust the port mapping of an existing Docker container without having to delete and recreate the container, but this involves some manual steps as Docker does not allow direct remapping of ports for an already created container. <br><br>Here’s the process you can follow: <br><br>1. **Stop the existing container:** <br>```bash<br>docker stop mysql_dev<br>``` <br>2. **Rename or remove the existing container (optional):** <br>To avoid conflicts, you can rename the existing container or remove it (just the container, not the data): <br>**Rename:** <br>```bash<br>docker rename mysql_dev mysql_dev_old<br>``` <br>**Remove the container (keeping the data in the volume):** <br>```bash<br>docker rm mysql_dev

<br>``` <br>3. **Start a new container with the new port configuration:** <br>Use the command below to start a new container using the new port configuration: <br>```bash<br>docker run -d --name mysql_dev -p 37:3306 \ <br>-e MYSQL_ROOT_PASSWORD='yourSecurePassword' \ <br>-v mysql_data:/var/lib/mysql \ <br>mysql:8.0<br>``` <br>4. **Check if the container is running:** <br>Confirm that the new container is running and that the port is correctly mapped: <br>```bash<br>docker ps<br>``` <br>This should show the `mysql_dev` container with port 37 mapped to 3306. |
| **8. Alternativa: Docker Compose**                            | Se você está usando `docker-compose`, apenas atualize o arquivo `docker-compose.yml` com a nova configuração de porta: <br><br>```yaml<br>ports:<br> - "37:3306"<br>``` <br>Depois, aplique as mudanças sem recriar os volumes: <br>```bash<br>docker-compose up -d --force-recreate --no-deps mysql<br>``` <br>Isso recriará o contêiner `mysql` com a nova configuração de portas, mantendo os dados intactos. | If you are using `docker-compose`, simply update the `docker-compose.yml` file with the new port configuration: <br><br>```yaml<br>ports:<br> - "37:3306"<br>``` <br>Then, apply the changes without recreating the volumes: <br>```bash<br>docker-compose up -d --force-recreate --no-deps mysql<br>``` <br>This will recreate the `mysql` container with the new port configuration while keeping the data intact. |